<!DOCTYPE html>
<html>
<head>
    <title>Braintree Hosted Fields Test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script src="https://js.braintreegateway.com/web/3.0.0/js/client.min.js"></script>
    <script src="https://js.braintreegateway.com/web/3.0.0/js/hosted-fields.min.js"></script>

    <style>
      /* Style the containers for the hosted fields */
      .hosted-field {
        border: 1px solid #ccc;
        padding: 3px;
        margin-bottom: 2px;
      }
    </style>
</head>
<body>

    <div class="demo-frame">  
      <form action="/" method="post" id="cardForm" >
        <label class="hosted-fields--label" for="card-number">Card Number</label>
        <div id="card-number" class="hosted-field"></div>

        <label class="hosted-fields--label" for="expiration-date">Expiration Date</label>
        <div id="expiration-date" class="hosted-field"></div>

        <label class="hosted-fields--label" for="cvv">CVV</label>
        <div id="cvv" class="hosted-field"></div>

        <label class="hosted-fields--label" for="postal-code">Postal Code</label>
        <div id="postal-code" class="hosted-field"></div>

        <div class="button-container">
          <input type="submit" class="button button--small button--green" value="Purchase" id="submit"/>
        </div>
        
        <input type="hidden" id="nonce" name="payment_method_nonce" />
      </form>
    </div>

    <script>
    // ⚠️ IMPORTANT: Replace this placeholder with a real Client Token 
    // generated by your server-side Braintree SDK (in your Sandbox environment).
    const authorization = 'sandbox_b8pnw7jf_3b7y25mkpt8zyqn6'; 
    const form = document.getElementById('cardForm');
    const submitButton = document.getElementById('submit');

    // 1. Create the Braintree Client Instance
    braintree.client.create({
      authorization: authorization
    }, (clientErr, clientInstance) => {
      if (clientErr) {
        console.error('Error creating Braintree Client:', clientErr);
        return;
      }

      // 2. Create the Hosted Fields Instance
      braintree.hostedFields.create({
        client: clientInstance,
        fields: {
          number: {
            selector: '#card-number',
            placeholder: 'Card Number'
          },
          expirationDate: {
            selector: '#expiration-date',
            placeholder: 'MM/YY'
          },
          cvv: {
            selector: '#cvv',
            placeholder: 'CVV'
          },
          postalCode: {
            selector: '#postal-code',
            placeholder: 'Postal Code'
          }
        }
      }, (hostedFieldsErr, hostedFieldsInstance) => {
        if (hostedFieldsErr) {
          console.error('Error creating Hosted Fields:', hostedFieldsErr);
          return;
        }

        // 3. Handle Form Submission
        form.addEventListener('submit', (event) => {
          event.preventDefault();

          // Disable button to prevent double-submission
          submitButton.disabled = true;

          // Tokenize the card data securely
          hostedFieldsInstance.tokenize((tokenizeErr, payload) => {
            if (tokenizeErr) {
              console.error('Tokenization Error:', tokenizeErr);
              alert('Payment error. Check the console for details.');
              submitButton.disabled = false;
              return;
            }

            // SUCCESS! A payment method nonce has been generated.
            console.log('Got nonce:', payload.nonce);
            console.log('Card type:', payload.details.cardType);

            // 4. Send the nonce to your server
            // Fill the hidden input and submit the form to your backend
            document.getElementById('nonce').value = payload.nonce;
            
            // For a real test, uncomment the line below:
            // form.submit();

            // For this client-side test, we'll just log and re-enable the button
            alert('Tokenization successful! Nonce logged to console.');
            submitButton.disabled = false;
          });
        });
      });
    });
    </script>

</body>
</html>